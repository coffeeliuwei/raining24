<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <title>学生管理</title>
  <link rel="stylesheet" href="assets/style.css">
</head>
<body>
<header>
  <nav>
    <a href="/index.html">首页</a>
    <a href="/students.html">学生管理</a>
    <a href="/courses.html">课程管理</a>
    <a href="/enroll.html">选课管理</a>
  </nav>
</header>
<main>
  <h2>学生列表</h2>
  <table class="table">
    <thead><tr><th>学号</th><th>姓名</th><th>性别</th><th>电话</th><th>生日</th></tr></thead>
    <tbody id="rows"></tbody>
  </table>

  <div class="card">
    <h3>新增学生</h3>
    <div id="form-stu">
      <div class="form-row"><label>学号</label><br><input name="id" /></div>
      <div class="form-row"><label>姓名</label><br><input name="name" /></div>
      <div class="form-row"><label>男生</label> <input type="checkbox" name="sex" checked /></div>
      <div class="form-row"><label>电话</label><br><input name="phone" /></div>
      <button class="btn" id="btn-add">添加</button>
    </div>
  </div>
</main>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="/ext/lwquery.js"></script>
<script src="assets/miniquery.js"></script>
<script>
function load(){
  $.ajax({url:'/api/students', method:'GET'}).then(function(resp){
    var list = (resp&&resp.data) || [];
    var tpl = '<tr><td>{{id}}</td><td>{{name}}</td><td>{{sex}}</td><td>{{phone}}</td><td>{{brithday}}</td></tr>';
    $$.call && null; // noop
    $.html(document.querySelector('#rows'), $.renderList(tpl, list));
  });
}
$.on(document.querySelector('#btn-add'), 'click', function(){
  var data = $.form('#form-stu').get();
  data.sex = !!data.sex;
  LW.rest('/api/students', data, function(){ load(); });
});
load();
</script>
</body>
</html>