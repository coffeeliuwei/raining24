# Java Web课程实训项目指导书

项目：Mini 教务选课系统（training24）
访问地址：启动后浏览器访问`http://localhost:8080/`

一、项目结构
- `src/com/training/` 后端源码
  - `Main.java`：启动类，创建HttpServer，注册路由与静态资源处理。
  - `framework/annotations`：`@Controller`、`@Route`、`@Inject`、`@FieldFormat`。
  - `framework/core`：`Router`（注解扫描注册）、`Injector`（依赖注入）、`RequestContext`（封装请求）、`HttpServerApp`（统一启动）。
  - `framework/utils`：`Json`（简易JSON序列化/解析）、`Strings`（工具）。
  - `services`：`StudentService`、`CourseService`、`EnrollService`（内存数据与业务）。
  - `controllers`：`StudentController`、`CourseController`、`EnrollController`（注解式接口）。
  - `entities`：`Student`、`Course`（带`@FieldFormat`示例）。
- `web/` 前端资源
  - `index.html`、`students.html`、`courses.html`、`enroll.html`
  - `assets/miniquery.js`（DOM/模板/Ajax/表单）、`assets/style.css`
- `run.ps1`：PowerShell脚本，一键编译运行
- `docs/`：任务书与指导书

二、后端微框架说明
1) 路由与控制器
- 在控制器类上加`@Controller`，在方法上加`@Route(path="/api/students", method="GET")`。
- 运行时通过反射扫描控制器对象的方法，按`method + path`注册处理函数。
- 处理函数签名建议：`String handle(RequestContext ctx)`或`String handle(RequestContext ctx, Map<String,String> params)`。

2) 依赖注入（DI）
- 在控制器的字段上使用`@Inject`（如`@Inject StudentService studentService;`）。
- 启动时`Injector`创建服务单例并填充到控制器字段（反射`setAccessible(true)`后`set`）。

3) 注解格式化
- 在实体字段上使用`@FieldFormat("yyyy-MM-dd")`，序列化到JSON时按指定格式处理`Date/Timestamp`。

4) JSON工具
- 遍历对象字段，反射调用getter，按类型处理日期与基本类型，输出`application/json`文本。

5) 静态资源
- `/`下静态文件由`HttpServerApp`托管到`web/`目录，支持基本的`text/html`、`text/css`、`application/javascript`。

三、接口设计（示例）
- `GET /api/students`：返回学生列表
- `POST /api/students`：新增学生，Body：`{"id":20201,"name":"张三","sex":true,"phone":"138..."}`
- `GET /api/courses`：返回课程列表
- `POST /api/courses`：新增课程
- `POST /api/enroll`：选课，Body：`{"studentId":20201,"courseName":"JavaWeb"}`
- 所有响应统一格式：`{"error":0,"reason":"ok","data":...}`；错误时`error!=0`并附`reason`

四、前端微框架（miniquery.js）用法
- 选择器：`$$(selector)`返回原生元素或数组；`$.on(el, 'click', fn)`绑定事件
- Ajax：`$.ajax({url, method:'GET'|'POST', json:true, data:{...}}).then(res=>{})`
- 模板：`$.template(
  '<tr><td>{{id}}</td><td>{{name}}</td></tr>',
  {id:1,name:'张三'}
)`
- 表单：`$.form('#formId').get()`返回键值对象；`$.form('#formId').set(obj)`设置值

五、上手步骤
1) 打开PowerShell，进入`training24`目录运行：`./run.ps1`
2) 浏览器访问`http://localhost:8080/`，进入首页
3) 进入“学生管理/课程管理/选课管理”页面，进行增删与选课联动

六、实训路线建议（24课时）
- 阶段A：框架基建（路由、注解、Injector、JSON）
- 阶段B：学生/课程服务与控制器；定义数据结构与校验
- 阶段C：前端微框架实现与页面渲染；接口联调
- 阶段D：选课业务串联，错误处理与用户体验
- 阶段E：反射注解进阶与扩展任务；总结与汇报

七、扩展任务（可选）
- 分页与搜索；导出CSV
- 简易权限模型（Session内存）
- 单元测试与日志记录

八、常见问题
- 端口占用：修改`Main.java`端口或关闭占用进程
- 编译失败：确认已安装JDK并在环境变量`PATH`中
- 无法访问静态资源：确认`web/`文件存在且路径配置正确